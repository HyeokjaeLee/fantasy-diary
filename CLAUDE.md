# CLAUDE Project Memory / Ground Rules

프로젝트 전역 공통 가이드. 모든 sub-agent는 이 문서를 우선 참조.

## 스택

- FE: Next.js 15(App Router), React 19, Tailwind CSS v4, shadcn/ui
- i18n: next-intl v4
- 검증: zod v4
- BE: tRPC v11(routers/procedures), Supabase(Auth/DB)
- Package Manager: bun

## 공통 원칙

- 타입스크립트: `any` 금지, 좁은 타입/명시적 반환, 불변성 우선, early return 적극 사용
- 경계: 서버/클라 컴포넌트 경계 명확, 민감 로직은 서버 전용
- 검증: 모든 입력은 zod 스키마로 검증, 서버에서도 재검증
- 오류: 의미 있는 에러 메시지, 사용자 친화적 표시, 로깅 포인트 식별
- 접근성(A11y): 시맨틱/aria/포커스/키보드 내비게이션/명도 대비
- i18n: 하드코딩 금지, `useTranslations` 사용, 키는 `messages/*.json`에 정의
- 스타일: Tailwind 유틸 우선, 임의 값 남용 금지, 토큰화된 스케일 유지

## 디자인 시스템(shadcn/ui)

- 기본: shadcn/ui 프리미티브 우선 사용 → 커스텀 시 토큰/변수 재사용
- 토큰: 타입스케일, spacing, color-scheme 일관 유지
- 상태: hover/focus/disabled/error 등 상호작용 상태 정의 필수

## 백엔드(tRPC v11 + Supabase)

- 구조: `app/api` 또는 별도 서버 레이어에서 tRPC 라우터/프로시저 정의
- 스키마: 입력/출력 zod 스키마, 타입 추론으로 클라 안전성 확보
- 오류: `TRPCError`로 분류/코드 관리, 에지/권한/레이스 처리
- 권한: Supabase 세션/권한 확인, RLS 정책 전제, 민감 정보 서버 한정
- 성능: N+1 회피, 적절한 인덱스/캐싱/스트리밍 선택

## 테스트/검증

- 단위: 스키마/훅/유틸/프로시저 단위 테스트 권장
- 수동: 주요 플로우(빈/에러/권한) 시나리오 체크리스트 유지

## 코드 스타일

- 파일/폴더 네이밍 일관, 모듈 단일 책임
- PR에는 변경 요약, 리스크, 테스트 포인트 포함

## 기획/문서 운영(serena MCP)

- 단일 소스: 기획 산출물(PRD/플로우/요구사항/결정 로그)은 serena MCP로 생성·저장·버전 관리.
- 변경 트리거: 범위/지표/마일스톤/플로우/의사결정 변경 시 즉시 업데이트.
- 메타데이터: 제목/버전/상태/담당/연관 이슈·PR/레퍼런스(와이어프레임·데모) 태깅.
- 연결: 이슈/PR에서 serena 문서 링크를 필수로 참조, 문서에서도 역링크 유지.
- 배포 전 확인: 최신 serena 버전 기준으로 스코프/수용 기준(AC) 재확인.

## Sub-agent 사용 가이드

- frontend-dev
  - 언제: UI 컴포넌트/페이지 구현·수정, 상태/UX 개선, i18n 키 작업, shadcn/ui 적용, A11y 점검 필요 시
  - 입력: 요구사항 요약, 디자인/와이어 링크, 컴포넌트 트리/데이터 흐름, i18n 키 초안, 관련 serena 문서 링크
  - 출력: 수정/생성 파일 목록+패치 요약, Props/타입 정의, 상태/이벤트 흐름, i18n 키 변경, A11y 체크리스트

- backend-dev
  - 언제: tRPC 라우터/프로시저 추가·수정, Supabase 스키마/권한, 서버 액션/Route Handler, 오류/로깅 설계 필요 시
  - 입력: 데이터 모델/권한 요구, zod 스키마 초안, 경계/성능 조건, 관련 serena 문서 링크
  - 출력: 변경 파일+패치 요약, 프로시저 시그니처, zod 스키마, `TRPCError` 분류, 테스트/수동 시나리오

- designer (기획 포함)
  - 언제: IA/플로우/컴포넌트 시스템 설계, 카피/빈·에러 상태 정의, PRD/플로우 업데이트 필요 시
  - 입력: 문제/목표/지표, 제약/마일스톤, 현재 화면/컴포넌트, 사용자 시나리오, serena 링크
  - 출력: 화면/상태 다이어그램, 컴포넌트 카탈로그, 카피/i18n 키 제안, 반응형·토큰 규칙, serena 문서 업데이트

- code-reviewer
  - 언제: PR 전/대규모 변경 전 품질 점검(타입/아키텍처/안정성/A11y/i18n/스타일)
  - 입력: 변경 파일 목록/디프 링크, 목표/범위/리스크, 실행/테스트 방법, 관련 serena/이슈 링크
  - 출력: 파일·라인 근거 리뷰 코멘트, 빠른 수선→구조 개선→장기 리팩터 제안, 위험도/우선순위

- 공통 팁
  - 입력은 항상: 목표·AC, 현재 상태/제약, 관련 링크(코드/디자인/serena), 기대 산출물 포맷 명시
  - 산출물은 PR/이슈에 링크하고 serena에 역링크 유지
